const TAM=10;var tablero=[],tableroOponente=[],contDisparos=0,contDisparosOpo=0,tirosAleatorios=[],totalBarcos=0;function Jugador(e,t,o){this.nombre=e,this.barcos=t,this.tablero=o}function Barco(e,t,o,n){this.numeroCasillas=n,this.coordenada=e,this.danio=t,this.dir=o}function Portaaviones(e,t){Barco.call(this,e,0,t,5)}function Acorazado(e,t){Barco.call(this,e,0,t,4)}function Buque(e,t){Barco.call(this,e,0,t,3)}function Lancha(e,t){Barco.call(this,e,0,t,2)}function Velero(e,t){Barco.call(this,e,0,t,1)}function validarColocacion(){var e=document.getElementById("filaP"),t=e.options[e.selectedIndex].value,o=document.getElementById("columnaP"),n=o.options[o.selectedIndex].value,a=document.getElementById("direccionP"),r=a.options[a.selectedIndex].value,l=document.getElementById("filaA"),d=l.options[l.selectedIndex].value,c=document.getElementById("columnaA"),s=c.options[c.selectedIndex].value,i=document.getElementById("direccionA"),u=i.options[i.selectedIndex].value,m=document.getElementById("filaB"),g=m.options[m.selectedIndex].value,p=document.getElementById("columnaB").options[c.selectedIndex].value,f=document.getElementById("direccionB"),h=f.options[f.selectedIndex].value,I=document.getElementById("filaL1"),v=I.options[I.selectedIndex].value,B=document.getElementById("columnaL1"),b=B.options[B.selectedIndex].value,y=document.getElementById("direccionL1"),E=y.options[y.selectedIndex].value,A=document.getElementById("filaL2"),M=A.options[A.selectedIndex].value,x=document.getElementById("columnaL2"),T=x.options[x.selectedIndex].value,w=document.getElementById("direccionL2"),L=w.options[w.selectedIndex].value,k=document.getElementById("filaV1"),V=k.options[k.selectedIndex].value,C=document.getElementById("columnaV1"),O=C.options[C.selectedIndex].value,P=document.getElementById("direccionV1"),j=P.options[P.selectedIndex].value,D=document.getElementById("filaV2"),F=D.options[D.selectedIndex].value,q=document.getElementById("columnaV2"),J=q.options[q.selectedIndex].value,S=document.getElementById("direccionV2"),z=S.options[S.selectedIndex].value,H=document.getElementById("filaV3"),N=H.options[H.selectedIndex].value,G=document.getElementById("columnaV3"),K=G.options[G.selectedIndex].value,Q=document.getElementById("direccionV3");return colocar([[t,n,r,5],[d,s,u,4],[g,p,h,3],[v,b,E,2],[M,T,L,2],[V,O,j,1],[F,J,z,1],[N,K,Q.options[Q.selectedIndex].value,1]])}function colocar(e){var t=!0,o=new Array;if(e.forEach(e=>{if(noSeTocan(o,e[0],e[1],e[2],e[3])){switch(e[3]){case 5:e=new Portaaviones([e[0],e[1]],e[2]);break;case 4:e=new Acorazado([e[0],e[1]],e[2]);break;case 3:e=new Buque([e[0],e[1]],e[2]);break;case 2:e=new Lancha([e[0],e[1]],e[2]);break;case 1:e=new Velero([e[0],e[1]],e[2])}o.push(e)}else t=!1}),t){var n=new Jugador("Nuestro",o,tablero);o.forEach(e=>{var t=generaCoordenadas(parseInt(e.coordenada[0]),parseInt(e.coordenada[1]),e.dir,e.numeroCasillas);tablero.push(t)}),generaJugadores("Oponente"),document.getElementById("primeraPagina").style.display="none",caja.style.display="block",imprimirBarcos(n)}else document.getElementById("mensajeError").innerHTML="Posiciones incorrectas, los barcos no pueden super ponerse";return t}function generaJugadores(e){"nuestro"==e&&imprimirBarcos(generaFlotaAleatoria(e));generaFlotaAleatoria()}function generaFlotaAleatoria(e){var t=new Array,o=[1,1,1,2,3],n=5;for(let e=0;e<8;e++){for(var a=o[e];a>0;){var r,l=Math.floor(Math.random()*TAM),d=Math.floor(Math.random()*TAM),c=Math.random()>=.5;if(noSeTocan(t,l,d,c,n)){switch(n){case 5:r=new Portaaviones([l,d],c);break;case 4:r=new Acorazado([l,d],c);break;case 3:r=new Buque([l,d],c);break;case 2:r=new Lancha([l,d],c);break;case 1:r=new Velero([l,d],c)}t.push(r),a--}}n--}return t.forEach(t=>{var o=generaCoordenadas(t.coordenada[0],t.coordenada[1],t.dir,t.numeroCasillas);"nuestro"==e?tablero.push(o):tableroOponente.push(o)}),tablero.forEach(e=>{totalBarcos+=e.length}),new Jugador("Oponente",t,tablero)}function generaCoordenadas(e,t,o,n){var a=[];if(o)for(let o=t;o<n+t;o++)a.push([e,o]);else for(let o=e;o<n+e;o++)a.push([o,t]);return a}function noSeTocan(e,t,o,n,a){var r;if(!(r=n?o+a<TAM:t+a<TAM))return!1;if(0==e.length)return r;for(let r=0;r<e.length;r++){var l=generaCoordenadas(e[r].coordenada[0],e[r].coordenada[1],e[r].dir,e[r].numeroCasillas),d=generaCoordenadas(t,o,n,a);for(let e=0;e<l.length;e++)if(0!=d.filter(t=>l[e][0]==t[0]&&l[e][1]==t[1]).length)return!1}return!0}function imprimirBarcos(e){var t=document.getElementById("miTablero").getElementsByTagName("td");for(let e=0;e<t.length;e++){let o=t[e].getAttribute("id").split("");for(let n=0;n<tablero.length;n++){tablero[n].forEach(n=>{n[0]==o[1]&&n[1]==o[2]&&t[e].setAttribute("class","barcos")})}}}var aleatorio=document.getElementById("aleatorio"),caja=document.getElementById("caja");caja.style.display="none",aleatorio.addEventListener("click",function(e){e.preventDefault,document.getElementById("primeraPagina").style.display="none",caja.style.display="block"});var botones=document.querySelectorAll("button");function comprobarTiro(e){return function(){var t=!0,o=e.getAttribute("id").split(""),n=o[1],a=o[0];for(let o=0;o<tableroOponente.length;o++)for(let c=0;c<tableroOponente[o].length;c++){var r=tableroOponente[o][c],l=r[0],d=r[1];n==l&&a==d&&(t=!1,e.setAttribute("class","tocado"),e.setAttribute("disabled","disabled"),contDisparos++)}contDisparos==totalBarcos&&(document.getElementById("mensajeFin").innerHTML="Enhorabuena, has ganado!"),t&&(e.setAttribute("class","agua"),e.setAttribute("disabled","disabled"),tiroAleatorio())}}function tiroAleatorio(){for(var e=!0,t=Math.floor(Math.random()*TAM-1)+1,o=Math.floor(Math.random()*TAM-1)+1,n=[t,o];e&&0!=tirosAleatorios.length;){e=!1;for(let t=0;t<tirosAleatorios.length;t++)tirosAleatorios[t][0]==n[0]&&tirosAleatorios[t][1]==n[1]&&(e=!0);n=[t=Math.floor(Math.random()*TAM-1)+1,o=Math.floor(Math.random()*TAM-1)+1]}tirosAleatorios.push(n);var a="F"+t+o,r=document.querySelectorAll("td");for(let e=0;e<r.length;e++){var l=r[e].getAttribute("id");for(let t=0;t<tablero.length;t++)tablero[t].forEach(t=>{var o=l.split("");l==a&&(t[0]==o[1]&&t[1]==o[2]?(r[e].setAttribute("class","tocado"),++contDisparosOpo==totalBarcos&&(document.getElementById("mensajeFin").innerHTML="Lo sentimos, has perdido."),tiroAleatorio()):r[e].setAttribute("class","agua"))})}}botones.forEach(e=>{e.addEventListener("click",comprobarTiro(e))});