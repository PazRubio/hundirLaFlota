const TAM=10;var tablero=[],tableroOponente=[],contDisparos=0,contDisparosOpo=0,tirosAleatorios=[],totalBarcos=0;function Jugador(e,t,o){this.nombre=e,this.barcos=t,this.tablero=o}function Barco(e,t,o,a){this.numeroCasillas=a,this.coordenada=e,this.danio=t,this.dir=o}function Portaaviones(e,t){Barco.call(this,e,0,t,5)}function Acorazado(e,t){Barco.call(this,e,0,t,4)}function Buque(e,t){Barco.call(this,e,0,t,3)}function Lancha(e,t){Barco.call(this,e,0,t,2)}function Velero(e,t){Barco.call(this,e,0,t,1)}function validarColocacion(e){var t=document.getElementById("filaP"),o=t.options[t.selectedIndex].value,a=document.getElementById("columnaP"),n=a.options[a.selectedIndex].value,r=document.getElementById("direccionP"),l=r.options[r.selectedIndex].value,d=document.getElementById("filaA"),c=d.options[d.selectedIndex].value,i=document.getElementById("columnaA"),s=i.options[i.selectedIndex].value,u=document.getElementById("direccionA"),m=u.options[u.selectedIndex].value,g=document.getElementById("filaB"),p=g.options[g.selectedIndex].value,f=document.getElementById("columnaB").options[i.selectedIndex].value,h=document.getElementById("direccionB"),v=h.options[h.selectedIndex].value,I=document.getElementById("filaL1"),B=I.options[I.selectedIndex].value,b=document.getElementById("columnaL1"),y=b.options[b.selectedIndex].value,E=document.getElementById("direccionL1"),A=E.options[E.selectedIndex].value,M=document.getElementById("filaL2"),x=M.options[M.selectedIndex].value,T=document.getElementById("columnaL2"),w=T.options[T.selectedIndex].value,L=document.getElementById("direccionL2"),k=L.options[L.selectedIndex].value,V=document.getElementById("filaV1"),C=V.options[V.selectedIndex].value,O=document.getElementById("columnaV1"),P=O.options[O.selectedIndex].value,j=document.getElementById("direccionV1"),D=j.options[j.selectedIndex].value,F=document.getElementById("filaV2"),q=F.options[F.selectedIndex].value,J=document.getElementById("columnaV2"),S=J.options[J.selectedIndex].value,z=document.getElementById("direccionV2"),H=z.options[z.selectedIndex].value,N=document.getElementById("filaV3"),G=N.options[N.selectedIndex].value,K=document.getElementById("columnaV3"),Q=K.options[K.selectedIndex].value,R=document.getElementById("direccionV3"),U=[[o,n,l,5],[c,s,m,4],[p,f,v,3],[B,y,A,2],[x,w,k,2],[C,P,D,1],[q,S,H,1],[G,Q,R.options[R.selectedIndex].value,1]];return e.preventDefault,colocar(U)}function colocar(e){var t=!0,o=new Array;if(e.forEach(e=>{if(noSeTocan(o,e[0],e[1],e[2],e[3])){switch(e[3]){case 5:e=new Portaaviones([e[0],e[1]],e[2]);break;case 4:e=new Acorazado([e[0],e[1]],e[2]);break;case 3:e=new Buque([e[0],e[1]],e[2]);break;case 2:e=new Lancha([e[0],e[1]],e[2]);break;case 1:e=new Velero([e[0],e[1]],e[2])}o.push(e)}else t=!1}),t){var a=new Jugador("Nuestro",o,tablero);o.forEach(e=>{var t=generaCoordenadas(parseInt(e.coordenada[0]),parseInt(e.coordenada[1]),e.dir,e.numeroCasillas);tablero.push(t)}),generaJugadores("Oponente"),document.getElementById("primeraPagina").style.display="none",caja.style.display="block",imprimirBarcos(a)}else document.getElementById("mensajeError").innerHTML="Posiciones incorrectas, los barcos no pueden super ponerse";return t}function generaJugadores(e){"nuestro"==e&&imprimirBarcos(generaFlotaAleatoria(e));generaFlotaAleatoria()}function generaFlotaAleatoria(e){var t=new Array,o=[1,1,1,2,3],a=5;for(let e=0;e<8;e++){for(var n=o[e];n>0;){var r,l=Math.floor(Math.random()*TAM),d=Math.floor(Math.random()*TAM),c=Math.random()>=.5;if(noSeTocan(t,l,d,c,a)){switch(a){case 5:r=new Portaaviones([l,d],c);break;case 4:r=new Acorazado([l,d],c);break;case 3:r=new Buque([l,d],c);break;case 2:r=new Lancha([l,d],c);break;case 1:r=new Velero([l,d],c)}t.push(r),n--}}a--}return t.forEach(t=>{var o=generaCoordenadas(t.coordenada[0],t.coordenada[1],t.dir,t.numeroCasillas);"nuestro"==e?tablero.push(o):tableroOponente.push(o)}),tablero.forEach(e=>{totalBarcos+=e.length}),new Jugador("Oponente",t,tablero)}function generaCoordenadas(e,t,o,a){var n=[];if(o)for(let o=t;o<a+t;o++)n.push([e,o]);else for(let o=e;o<a+e;o++)n.push([o,t]);return n}function noSeTocan(e,t,o,a,n){var r;if(!(r=a?o+n<TAM:t+n<TAM))return!1;if(0==e.length)return r;for(let r=0;r<e.length;r++){var l=generaCoordenadas(e[r].coordenada[0],e[r].coordenada[1],e[r].dir,e[r].numeroCasillas),d=generaCoordenadas(t,o,a,n);for(let e=0;e<l.length;e++)if(0!=d.filter(t=>l[e][0]==t[0]&&l[e][1]==t[1]).length)return!1}return!0}function imprimirBarcos(e){var t=document.getElementById("miTablero").getElementsByTagName("td");for(let e=0;e<t.length;e++){let o=t[e].getAttribute("id").split("");for(let a=0;a<tablero.length;a++){tablero[a].forEach(a=>{a[0]==o[1]&&a[1]==o[2]&&t[e].setAttribute("class","barcos")})}}}var aleatorio=document.getElementById("aleatorio"),caja=document.getElementById("caja");caja.style.display="none",aleatorio.addEventListener("click",function(e){e.preventDefault,document.getElementById("primeraPagina").style.display="none",caja.style.display="block"});var validar=document.getElementById("validar");validar.addEventListener("click",function(e){e.preventDefault,validarColocacion(e)});var botones=document.querySelectorAll("button");function comprobarTiro(e){return function(){var t=!0,o=e.getAttribute("id").split(""),a=o[1],n=o[0];for(let o=0;o<tableroOponente.length;o++)for(let c=0;c<tableroOponente[o].length;c++){var r=tableroOponente[o][c],l=r[0],d=r[1];a==l&&n==d&&(t=!1,e.setAttribute("class","tocado"),e.setAttribute("disabled","disabled"),contDisparos++)}contDisparos==totalBarcos&&(document.getElementById("mensajeFin").innerHTML="Enhorabuena, has ganado!"),t&&(e.setAttribute("class","agua"),e.setAttribute("disabled","disabled"),tiroAleatorio())}}function tiroAleatorio(){for(var e=!0,t=Math.floor(Math.random()*TAM-1)+1,o=Math.floor(Math.random()*TAM-1)+1,a=[t,o];e&&0!=tirosAleatorios.length;){e=!1;for(let t=0;t<tirosAleatorios.length;t++)tirosAleatorios[t][0]==a[0]&&tirosAleatorios[t][1]==a[1]&&(e=!0);a=[t=Math.floor(Math.random()*TAM-1)+1,o=Math.floor(Math.random()*TAM-1)+1]}tirosAleatorios.push(a);var n="F"+t+o,r=document.querySelectorAll("td");for(let e=0;e<r.length;e++){var l=r[e].getAttribute("id");for(let t=0;t<tablero.length;t++)tablero[t].forEach(t=>{var o=l.split("");l==n&&(t[0]==o[1]&&t[1]==o[2]?(r[e].setAttribute("class","tocado"),++contDisparosOpo==totalBarcos&&(document.getElementById("mensajeFin").innerHTML="Lo sentimos, has perdido."),tiroAleatorio()):r[e].setAttribute("class","agua"))})}}botones.forEach(e=>{e.addEventListener("click",comprobarTiro(e))});